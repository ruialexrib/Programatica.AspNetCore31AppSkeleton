@model List<AuditViewModel>

@{
    string on_grid_dblclick = Razor.Rnd();
    string on_close_click = Razor.Rnd();
    string on_grid_customizeCell = Razor.Rnd();
    string grid = Razor.Rnd();

    var systemid = @Model.FirstOrDefault().ContentSystemId;
    var type = @Model.FirstOrDefault().ContentType;
}


<div class="modal-header">
    <h5 class="modal-title"><i class="fa fa-lock"></i> Audit History for '@systemid' @type type </h5>
</div>

<div class="modal-body">

    <div class="row">
        <div class="col-md-12 p-3">

            <div class="alert alert-light alert-dismissible fade show" role="alert">
                Double click audit record to view fileds track changes.
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>


            @{
                List<object> filterSettings = new List<object>();
                filterSettings.Add(new { field = "ContentFunction", matchCase = false, @operator = "notequal", predicate = "and", value = "Inspect" });
            }

            @{
                List<object> sortSettings = new List<object>();
                sortSettings.Add(new { field = "CreatedDate", direction = "Descending" });
            }

        <ejs-grid id="@grid"
                  width="auto"
                  dataSource="@Model"
                  allowPaging="true"
                  allowSorting="true"
                  allowFiltering="true"
                  recordDoubleClick="@on_grid_dblclick"
                  queryCellInfo="@on_grid_customizeCell">
            <e-grid-pagesettings pageSizes="true" pageSize="5"></e-grid-pagesettings>
            <e-grid-filterSettings columns="filterSettings" type="Excel"></e-grid-filterSettings>
            <e-grid-sortsettings columns="sortSettings"></e-grid-sortsettings>
            <e-grid-columns>
                <e-grid-column width="70" field="Id" headerText="ID" isPrimaryKey="true"></e-grid-column>
                <e-grid-column field="ContentFunction" headerText="FUNCTION"></e-grid-column>
                <e-grid-column field="CreatedUser" headerText="USER"></e-grid-column>
                <e-grid-column field="CreatedDate" headerText="DATE" customFormat="@(new { type ="date", format="yyyy-MM-dd HH:mm:ss" })" type="date"></e-grid-column>
                <e-grid-column field="TrackedFieldsCount" headerText="FIELDS"></e-grid-column>

            </e-grid-columns>
        </ejs-grid>

        </div>
    </div>

</div>

<div class="modal-footer">
    <a href="#" class="btn btn-secondary" onclick="@(on_close_click)(event)">CLOSE</a>
</div>

<script type="text/javascript">

    @on_grid_dblclick = (args) => {
        var id = args.rowData.Id;
        layout.show_audits_trackchanges(id);
    }

    @on_close_click = (e) => {
        e.preventDefault();
        modal.close(e);
    };

    @on_grid_customizeCell = (args) => {
        if (args.column.field === 'TrackedFieldsCount') {

            if (args.data['TrackedFieldsCount'] == 0) {
                args.data['TrackedFieldsCount'] = "No tracked fields available"
            }
            if (args.data['TrackedFieldsCount'] == 1) {
                args.data['TrackedFieldsCount'] = args.data['TrackedFieldsCount'] + " field change"
            }
            if (args.data['TrackedFieldsCount'] > 1) {
                args.data['TrackedFieldsCount'] = args.data['TrackedFieldsCount'] + " fields changes"
            }
        }
    };

</script>

<ejs-scripts></ejs-scripts>

